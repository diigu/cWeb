<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>移动安全实验室</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/theme.css" rel="stylesheet">
</head>

<body>

<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../index.html">移动安全实验室</a>
          </div>
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="active"><a href="../index.html">Home</a></li>
                <li class="active visible-xs-block"><a href="../links.html">Links</a></li>
                <li class="active"><a href="../archive.html">Archive</a></li>
                <li class="active"><a href="../about.html">About</a></li>
                <li class="active"><a href="../feed.xml">RSS</a></li>
                
            </ul>
          </div>
    </div>
</div>


<div class="container container-middle">
    <div class="row">
        <div class="col-md-3 hidden-xs">
            <div class="sidebar well">
    <ul>
        
          <li><a href="../open-listen-port/index.html">本地端口开放越权风险</a></li>
        
          <li><a href="../webview-ignore-ssl-error/index.html">WebView组件忽略SSL证书验证错误漏洞</a></li>
        
          <li><a href="../content-provider-file-traversal/index.html">Content Provider目录遍历漏洞</a></li>
        
          <li><a href="../sql-injection/index.html">SQL注入漏洞</a></li>
        
          <li><a href="../webview-setsavepassword/index.html">WebView密码明文保存漏洞</a></li>
        
          <li><a href="../traversal-zip-file/index.html">ZIP文件解压目录遍历风险</a></li>
        
          <li><a href="../pendingintent-leak-information/index.html">PendingIntent包含隐式Intent风险</a></li>
        
          <li><a href="../secure-random/index.html">随机数使用不当漏洞</a></li>
        
          <li><a href="../clipboard-leak/index.html">剪贴板敏感信息泄露风险</a></li>
        
          <li><a href="../logcat-leak-sensitive-information/index.html">日志泄露隐私风险</a></li>
        
          <li><a href="../intent-data-leak/index.html">intent敏感数据泄露风险</a></li>
        
          <li><a href="../exec-code/index.html">运行其它可执行程序风险</a></li>
        
          <li><a href="../global-rw-of-sharepreference/index.html">SharedPreference全局读写漏洞</a></li>
        
          <li><a href="../global-rw-of-database/index.html">数据库全局读写漏洞</a></li>
        
          <li><a href="../global-rw-of-file/index.html">文件全局读写漏洞</a></li>
        
          <li><a href="../recieve-broadcast-security/index.html">动态注册广播组件暴露风险</a></li>
        
          <li><a href="../sendbroadcast-information-leak/index.html">发送广播信息泄漏风险</a></li>
        
          <li><a href="../dynamic-load-dex-file/index.html">动态加载DEX文件风险</a></li>
        
          <li><a href="../weak-encryption/index.html">弱加密风险</a></li>
        
          <li><a href="../java-ssl-middle-man/index.html">Java层ssl中间人攻击漏洞</a></li>
        
          <li><a href="../native-ssl-middle-man/index.html">SSL本地库中间人攻击漏洞</a></li>
        
          <li><a href="../local-dos/index.html">Android 本地拒绝服务漏洞</a></li>
        
          <li><a href="index.html">WebView组件远程代码执行漏洞</a></li>
        
          <li><a href="../android-webview-cve-2012-6636/index.html">Android WebView 远程代码执行漏洞 CVE-2012-6636</a></li>
        
          <li><a href="../android-webview/index.html">WebView组件系统隐藏接口未移除漏洞</a></li>
        
          <li><a href="../intent-scheme-url/index.html">URL Scheme攻击漏洞</a></li>
        
          <li><a href="../android-fragment-injection/index.html">PreferenceActivity Fragment注入漏洞</a></li>
        
    </ul>
</div>

        </div>
        <div class="col-md-9">
          <div class="article">
            <div class="well">
                <h1><a href="../index.html">WebView组件远程代码执行漏洞</a></h1>
            <div class="post-content">
            <ul>
<li>漏洞类型：远程执行</li>
<li>威胁等级：中</li>
<li>漏洞来源：Daoyuan Wu, Rocky Chang</li>
<li>影响版本： Android 4.3 Android 4.2 Android 4.1 Android 4.0 Android 2.3 Android 2.2 Android 2.1</li>
</ul>

<h4 id="漏洞描述">漏洞描述</h4>

<p>近日，香港理工大学的研究人员Daoyuan Wu和Rocky Chang [<a href="https://daoyuan14.github.io/news/newattackvector.html">1</a>]发现了一组新的Android WebView中<code>addJavascriptInterface</code> API引起的远程代码执行漏洞。当用户开启了手机设置中辅助功能里的任意一项服务时，该漏洞就会被触发。</p>

<p>Android WebView中<code>addJavascriptInterface</code> API 引起的远程代码执行漏洞由来已久，最早被公布是<code>CVE-2012-6636</code>，描述了WebView中<code>addJavascriptInterface</code> API 会引起远程代码执行漏洞，之后的<code>CVE-2013-4710</code>是针对某些特定机型会存在<code>addJavascriptInterface</code> API 引起的远程代码执行漏洞。而最近的一次关于<code>addJavascriptInterface</code> API的漏洞公布是<code>CVE-2014-1939</code>，此漏洞公布了一个可利用的<code>Java Object searchBoxJavaBridge_</code>，此漏洞存在于Android 4.4 之前版本的<code>java/android/webkit/BrowserFrame.java</code> 代码中。而此次<code>CVE-2014-7224</code>发现的是两个新的<code>addJavascriptInterface</code> API 引起的可被利用的 <code>Java Object</code>。</p>

<p>根据 <code>android/webkit/AccessibilityInjector.java</code> [<a href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.3.1_r1/android/webkit/AccessibilityInjector.java#AccessibilityInjector">2</a>]代码中的介绍，发现当系统辅助功能中的任意一项服务被开启后，所有的WebView都会被加入两个<code>JS objects</code>，分别为是<code>accessibility</code>和<code>accessibilityTraversal</code>。如果APP使用了系统WebView的应用，并且设置了<code>setJavaScriptEnabled()</code>，那么恶意攻击者就可以使用<code>accessibility</code>和<code>accessibilityTraversal</code>这两个<code>Java Bridge</code>来执行远程攻击代码。而不同的Android 系统版本的可被攻击性是不一样的。由于Google 从API Level 17 （含）也就是Android4.2 开始，对于JavaScript代码通过<code>addJavascriptInterface</code>添加的java 代码的调用做出了限制，只有public并且声明了<code>@JavascriptInterface</code>的方法才可以被JavaScript代码调用。所以理论上在Android4.1（含）之前的版本上此漏洞会更容易被利用且有更高的危害。但是经过测试发现，有些手机即使系统版本是4.2，但是仍然通过利用此漏洞，在JavaScript中调用<code>getClass()</code>方法。下面的图3就是在红米1STD上运行测试程序的结果，此手机的Android版本是4.2.2。</p>

<p><img src="../images/webview_CVE-2014-7224/webview_CVE-2014-7224_0.png" alt="webview_CVE-2014-1939_0" title="webview_CVE-2014-1939_0"></p>

<p style="text-align:center">图1. AccessibilityInjector.java 部分代码</p>

<p><img src="../images/webview_CVE-2014-7224/webview_CVE-2014-7224_1.png" alt="webview_CVE-2014-1939_1" title="webview_CVE-2014-1939_1"><img src="../images/webview_CVE-2014-7224/webview_CVE-2014-7224_2.png" alt="webview_CVE-2014-1939_2" title="webview_CVE-2014-1939_2"></p>

<p>图2. 设置 --&gt; 辅助功能 　　　　　　　　　　　　　　　　　图3.Demo程序WebWiew加载检测页面</p>

<table><thead>
<tr>
<th>机型</th>
<th style="text-align: center">Android 版本</th>
<th style="text-align: right">是否存在漏洞</th>
</tr>
</thead><tbody>
<tr>
<td>三星S3</td>
<td style="text-align: center">4.1.2</td>
<td style="text-align: right">存在，易利用</td>
</tr>
<tr>
<td>三星Note2</td>
<td style="text-align: center">4.1.1</td>
<td style="text-align: right">存在，易利用</td>
</tr>
<tr>
<td>三星Note3</td>
<td style="text-align: center">4.3</td>
<td style="text-align: right">存在，不易利用</td>
</tr>
<tr>
<td>小米2s</td>
<td style="text-align: center">4.1.1</td>
<td style="text-align: right">存在，易利用</td>
</tr>
<tr>
<td>红米1s</td>
<td style="text-align: center">4.2.2</td>
<td style="text-align: right">存在，易利用</td>
</tr>
<tr>
<td>OPPO N1T</td>
<td style="text-align: center">4.2.2</td>
<td style="text-align: right">存在，不易利用</td>
</tr>
</tbody></table>

<p>表1 测试数据（易利用：暴露全部方法；不易利用：暴露部分特定方法）</p>

<h4 id="测试方法">测试方法</h4>

<p>如果手机系统版本低于（不含）4.4，而且开启了系统辅助功能中的某一项服务就有可能受到此威胁。可以在APP中打开一个<code>WebView addJavascriptInterface</code>漏洞“检测页面”[<a href="http://www.droidsec.org/tests/addjsif/">4</a>]，检测当前是否存在此漏洞。</p>

<h4 id="解决方案">解决方案</h4>

<ol>
<li><p>对于用户，如果手机系统的版本低于（不含）4.4，那么到系统的 设置 --&gt; 辅助功能 中查看是否有开启的服务，如果没有必要则关闭所有服务</p></li>
<li><p>对于APP开发者，如果使用了WebView，那么使用<code>WebView.removeJavascriptInterface(String name)</code> API，显示的移除<code>accessibility</code>和<code>accessibilityTraversal</code></p></li>
</ol>

<h4 id="参考资料">参考资料</h4>

<p>[1] <a href="https://daoyuan14.github.io/news/newattackvector.html">https://daoyuan14.github.io/news/newattackvector.html</a></p>

<p>[2] <a href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.3.1_r1/android/webkit/AccessibilityInjector.java#AccessibilityInjector">http://grepcode.com/file/repository.grepcode.com/java/ext/.../AccessibilityInjector.java#AccessibilityInjector</a></p>

<p>[3] <a href="http://developer.android.com/reference/android/webkit/WebView.html">http://developer.android.com/reference/android/webkit/WebView.html</a></p>

<p>[4] <a href="http://www.droidsec.org/tests/addjsif/">http://www.droidsec.org/tests/addjsif/</a></p>

            </div>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12 footer navbar-inverse navbar-fixed-bottom">
            <p class="copyright">&copy;2015 移动安全实验室. Powered by <a href="https://www.baidu.com">Baidu Inc</a></p>
        </div>
    </div>
</div>

</body>
</html>

